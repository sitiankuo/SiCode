<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- 找素数 -->

    <!-- <label for="quota">素数个数：</label>
    <input type="text" id="quota" name="quota" value="1000000">

    <button id="generate">生成素数</button>
    <button id="reload">重载</button>

    <div id="output"></div>

    <script>
        function generatePrimes(quota) {
            function isPrime(n) {
                for (let c = 2; c <= Math.sqrt(n); ++c) {
                    if (n % c === 0) {
                        return false;
                    }
                }
                return true;
            }
            const primes = [];
            const maximum = 1000000;
            while (primes.length < quota) {
                const candidate = Math.floor(Math.random() * (maximum + 1));
                if (isPrime(candidate)) {
                    primes.push(candidate);
                }
            }
            return primes;
        }
        document.querySelector('#generate').addEventListener('click', () => {
            const quota = document.querySelector('#quota').value;
            const primes = generatePrimes(quota);
            document.querySelector('#output').textContent = `完成！已生成素数${quota}个。`;
        });
        document.querySelector('#reload').addEventListener('click', () => {
            document.location.reload()
        });

    </script> -->


    <!-- 第二个 事件处理程序 -->
    <!-- <button id="xhr">点击发送请求</button>
    <button id="reload">重载</button>
    <pre readonly class="evebt-log"></pre>

    <script>
        const log = document.querySelector('.evebt-log');
        document.querySelector('#xhr').addEventListener('click', () => {
            log.textContent = '';
            const xhr = new XMLHttpRequest();
            xhr.addEventListener('loadend', () => {
                log.textContent = `${log.textContent}完成！状态码：${xhr.status}`;
            });
            xhr.open('GET', 'https://raw.githubusercontent.com/mdn/content/main/files/en-us/_wikihistory.json');
            xhr.send();
            log.textContent = '${log.textContent}请求已发起\n';
        });
        document.querySelector('#reload').addEventListener('click', () => {
            log.textContent = '';
            document.location.reload();
        });
    </script> -->


    <!-- 第三个  回调 -->

    <!-- 分解步骤 -->
    <!-- <script>
        function doStep1(init) {
            return init + 1;
        }
        function doStep2(init) {
            return init + 2;
        }
        function doStep3(init) {
            return init + 3;
        }
        function doOperation() {
            let result = 0;
            result = doStep1(result);
            result = doStep2(result);
            result = doStep3(result);
            console.log('结果：${result}');
        }
        doOperation(); -->
    <!-- 回调实现 -->
    <!-- <script>
        function doStep1(init) {
            const result = init + 1;
            callback(result);
        }
        function doStep2(init) {
            const result = init + 2;
            callback(result);
        }
        function doStep3(init) {
            const result = init + 3;
            callback(result);
        }
        function doOperation() {
            let result = 0;
            doStep1(0, result1 => {
                doStep2(result1, result2 => {
                    doStep3(result2, result3 => {
                        console.log('结果：${result}');
                    })
                });
            });
        }
        doOperation();
    </script>-->
    <!-- 第三种 promise实现异步 -->
    <script>
        // const fetchPromise = fetch('https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/products.json');

        // console.log(fetchPromise);

        // fetchPromise.then(response => {
        //     console.log(`已收到响应：${response.status}`);
        // });

        // console.log("已发送请求……");



        // const fetchPromise = fetch('https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/products.json');
        // console.log(fetchPromise);

        // fetchPromise.then(response => {
        //     console.log(`已收到响应：${response.status}`);
        // });

        // console.log("已发送请求……");


        // 链式使用promise
        // const fetchPromise = fetch('https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/products.json');

        // 第一种写法
        // fetchPromise.then(Response => {
        //     const jsonPromise = Response.json();
        //     jsonPromise.then(json => {
        //         console.log(json[0].name);
        //     })
        // })

        // 第二种写法（简便）promise链
        // fetchPromise
        //     .then(response => {
        //         if (!response.ok) {
        //             throw new Error('HTTP error:${response.status}');//检查服务器是否接受并处理该请求
        //         }
        //         return response.json();
        //     })
        //     .then(json => {
        //         console.log(json[0].name)
        //     })
        //     .catch(error => {
        //         console.log('无法获取产品列表：${error}');
        //     })
        // 三种状态
        //             待定（pending）：初始状态，既没有被兑现，也没有被拒绝。这是调用 fetch() 返回 Promise 时的状态，此时请求还在进行中。
        //             已兑现（fulfilled）：意味着操作成功完成。当 Promise 完成时，它的 then() 处理函数被调用。
        //             已拒绝（rejected）：意味着操作失败。当一个 Promise 失败时，它的 catch() 处理函数被调用。


        // 合并使用多个promise
        // promise.all()  接受一个promise数组
        // const fetchPromise1 = fetch('https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/products.json');
        // const fetchPromise2 = fetch('https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/not-found');
        // const fetchPromise3 = fetch('https://mdn.github.io/learning-area/javascript/oojs/json/superheroes.json');

        // Promise.all([fetchPromise1, fetchPromise2, fetchPromise3])
        //     .then(responses => {
        //         for (const response of responses) {
        //             console.log('${response.url}:${response.status}');
        //         }
        //     })
        //     .catch(error => {
        //         console.log('获取失败：${error}');
        //     })

        // // promise.any()一个通过即可，全部失败才是失败 不关心是哪一个
        // Promise.any([fetchPromise1, fetchPromise2, fetchPromise3])
        //     .then(response => {
        //         console.log(`${response.url}：${response.status}`);
        //     })
        //     .catch(error => {
        //         console.error(`获取失败：${error}`)
        //     });



        // async await 
        async function fetchProducts() {
            try {
                const response = await fetch('https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/products.json');
                if (!response.ok) {
                    throw new Error('HTTP 请求错误：${response.status}');
                }
                const json = await response.json();
                console.log(json[0].name);
            }
            catch (error) {
                console.log('无法获取产品列表：${error}');
            }
        }
        fetchProducts();
    </script>
</body>

</html>